<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decisions — Open Espresso Design Document</title>
  <link rel="stylesheet" href="css/design-document.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <div class="container">
    <!-- ================================================================ -->
    <!-- PAGE NAVIGATION -->
    <!-- ================================================================ -->
    <nav class="page-nav" aria-label="Document pages">
      <a href="DESIGN_DOCUMENT.html" class="nav-home">Home</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="current-state.html">Current State</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="hardware.html">Hardware</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="software.html">Software</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="safety.html">Safety</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="data-model.html">Data Model</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="requirements.html">Requirements</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="interfaces.html">Interfaces</a>
      <span class="nav-separator" aria-hidden="true">|</span>
      <a href="decisions.html" class="active">Decisions</a>
    </nav>

    <!-- ================================================================ -->
    <!-- DOCUMENT HEADER -->
    <!-- ================================================================ -->
    <header class="doc-header">
      <h1>Decisions &amp; Open Questions</h1>
      <p class="intro">Section 21 — Decided items and open hardware/software questions</p>
      <div class="doc-meta">
        <span class="tag tag-blue">Version 3.0</span>
        <span class="tag">2026-02-16</span>
        <span class="tag tag-green">MIT License</span>
      </div>
    </header>

    <main id="main-content">

      <!-- ================================================================ -->
      <!-- SECTION 21: Decisions & Open Questions -->
      <!-- ================================================================ -->
      <section class="section" id="section-21">
        <h2>21. Decisions &amp; Open Questions</h2>

        <!-- Decided -->
        <h3 id="decided">Decided</h3>

        <ul>
          <li><strong>Target machine:</strong> Gaggia Classic (pre-2015/2016 model) only <span class="tag tag-green">Decided</span></li>
          <li><strong>MCU:</strong> ESP32-S3 single MCU (evaluate, fall back to dual-MCU if real-time jitter is a problem) <span class="tag tag-green">Decided</span></li>
          <li><strong>Machine display:</strong> ILI9341 2.8" SPI TFT with capacitive touch, driven by LVGL <span class="tag tag-green">Decided</span></li>
          <li><strong>Remote UI:</strong> HTML5 web app served from ESP32 LittleFS, WebSocket for real-time data <span class="tag tag-green">Decided</span></li>
          <li><strong>iOS app:</strong> Not now. Build the WebSocket/REST API first. Add native app later if web app proves insufficient. <span class="tag tag-green">Decided</span></li>
          <li><strong>Nextion display:</strong> Dropped. Proprietary, vendor lock-in, dated. <span class="tag tag-green">Decided</span></li>
          <li><strong>WiFi requirement:</strong> Acceptable (home use only, stable network) <span class="tag tag-green">Decided</span></li>
          <li><strong>Electronics placement:</strong> External enclosure on rear panel. No bare PCBs inside machine. <span class="tag tag-green">Decided</span></li>
          <li><strong>Mounting method:</strong> Neodymium magnets on rear panel (no drilling). Cable glands for cable pass-through. <span class="tag tag-green">Decided</span></li>
          <li><strong>Inside machine:</strong> Only sensors (sealed), SSR (potted), dimmer (coated), PSU (potted), thermal fuse. No exposed ICs. <span class="tag tag-green">Decided</span></li>
          <li><strong>Hardware thermal fuse:</strong> 190 &deg;C thermal fuse in series with boiler element. Non-negotiable safety requirement (REQ-S-001). <span class="tag tag-green">Decided</span></li>
          <li><strong>GPIO pull-downs:</strong> 10k&Omega; pull-down resistors on SSR, dimmer, solenoid GPIOs (REQ-S-009). <span class="tag tag-green">Decided</span></li>
          <li><strong>EMI filter:</strong> LC filter on dimmer AC input + RC snubber across triac (REQ-S-012). <span class="tag tag-green">Decided</span></li>
          <li><strong>OTA authentication:</strong> Password required for firmware upload, restart, and factory reset. <span class="tag tag-green">Decided</span></li>
          <li><strong>API versioning:</strong> REST API uses /api/v1 prefix. WebSocket protocol versioned. <span class="tag tag-green">Decided</span></li>
        </ul>

        <!-- Open — Hardware -->
        <h3 id="open-hardware">Open — Hardware</h3>

        <ul>
          <li><strong>ESP32-S3 module selection:</strong> WROOM-1 (onboard antenna) vs WROVER (PSRAM + antenna)? PSRAM useful for web server asset caching and shot history. <span class="tag tag-amber">Open</span></li>
          <li><strong>ADC selection:</strong> Keep ADS1115 (16-bit, I2C, 860 SPS max) or switch to ADS1220 (24-bit, SPI, 2000 SPS)? Higher resolution helps pressure accuracy. <span class="tag tag-amber">Open</span></li>
          <li><strong>Thermocouple interface:</strong> Keep MAX31855 (SPI, basic) or use MAX31856 (SPI, cold-junction compensation, fault detection)? The MAX31856 has better fault detection built in. <span class="tag tag-amber">Open</span></li>
          <li><strong>Dimmer module:</strong> Design custom PCB or use off-the-shelf module (e.g., RobotDyn AC dimmer)? Custom PCB can integrate SSR + dimmer + level shifting. <span class="tag tag-amber">Open</span></li>
          <li><strong>Enclosure fabrication:</strong> 3D-printed PETG (cheap, custom, fast iteration) vs off-the-shelf IP54 ABS project box (proven sealing)? Can start with project box, design custom later. <span class="tag tag-amber">Open</span></li>
          <li><strong>Custom PCB vs dev boards:</strong> Single custom PCB (ESP32-S3 + ADC + thermocouple IC + connectors) vs ESP32 dev board + breakout modules? Custom PCB is cleaner but has longer lead time. <span class="tag tag-amber">Open</span></li>
          <li><strong>Cable type:</strong> Silicone-insulated wire (high-temp, flexible) vs PTFE (higher temp rating, stiffer). Silicone is easier to work with. <span class="tag tag-amber">Open</span></li>
          <li><strong>Thermal fuse type:</strong> Non-resettable (forces investigation, safer) vs resettable bimetal KSD301 (more convenient). Recommend non-resettable for safety. <span class="tag tag-amber">Open</span></li>
        </ul>

        <!-- Open — Software -->
        <h3 id="open-software">Open — Software</h3>

        <ul>
          <li><strong>Web app framework:</strong> Svelte (recommended — smallest bundle, compiles to vanilla JS, good DX for small teams) vs Preact (React API familiarity in 3KB, fallback if Svelte's learning curve is a barrier) vs vanilla JS (no build step, but harder to maintain as UI grows)? <span class="tag tag-amber">Open</span></li>
          <li><strong>Framework:</strong> ESP-IDF (native, full control, steeper learning curve) vs Arduino framework on ESP-IDF (easier, some overhead)? <span class="tag tag-amber">Open</span></li>
          <li><strong>Profile format:</strong> JSON (human-readable, parseable by web app) vs MessagePack (smaller, faster parsing on MCU)? <span class="tag tag-amber">Open</span></li>
          <li><strong>Shot logging:</strong> Store on ESP32 flash (limited space, ~100-500 shots) vs require web app to capture and store? <span class="tag tag-amber">Open</span></li>
          <li><strong>BLE scales:</strong> Keep supporting all current brands (Acaia, Felicita, Decent, Bookoo) or start with a subset? <span class="tag tag-amber">Open</span></li>
          <li><strong>Secure boot:</strong> ESP32-S3 supports eFuse-based secure boot. Low priority for personal use but trivial to enable. Document as optional for community. <span class="tag tag-amber">Open</span></li>
          <li><strong>Signed OTA:</strong> ESP32-S3 supports firmware signature verification. Prevents flashing tampered firmware. Nice-to-have. <span class="tag tag-amber">Open</span></li>
          <li><strong>HTTPS/WSS:</strong> TLS for web app communication. CPU-intensive on ESP32. Low priority for home LAN. <span class="tag tag-amber">Open</span></li>
        </ul>
      </section>

      <!-- ================================================================ -->
      <!-- PAGE FOOTER NAVIGATION -->
      <!-- ================================================================ -->
      <nav class="page-footer-nav" aria-label="Previous and next pages">
        <a href="interfaces.html" class="prev-page">
          <span class="material-symbols-rounded icon-sm">arrow_back</span>
          Interfaces
        </a>
      </nav>

      <!-- ================================================================ -->
      <!-- DOCUMENT FOOTER -->
      <!-- ================================================================ -->
      <footer class="doc-footer">
        <p><em>Document version: 3.0 — Updated: 2026-02-16</em></p>
        <p><em>Project: Open Espresso — open-source firmware for Gaggia Classic (pre-2015)</em></p>
        <p>This HTML version references SVG diagrams in <code>diagrams/</code> and uses an external stylesheet at <code>css/design-document.css</code>. The authoritative source is <a href="DESIGN_DOCUMENT.md">DESIGN_DOCUMENT.md</a>.</p>
      </footer>

    </main>
  </div>
</body>
</html>
