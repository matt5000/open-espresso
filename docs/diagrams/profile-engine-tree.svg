<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 380" width="600" height="380">
  <style>
    text { font-family: 'Source Sans 3', sans-serif; }
    .mono { font-family: 'Source Code Pro', monospace; font-size: 12px; }
  </style>
  <rect width="600" height="380" fill="#f8fafc" rx="4"/>
  <text x="300" y="26" text-anchor="middle" fill="#0f172a" font-size="16" font-weight="bold">Profile Engine (PhaseProfiler)</text>
  <!-- Root -->
  <rect x="20" y="42" width="120" height="30" rx="5" fill="#dbeafe" stroke="#1e40af" stroke-width="2"/>
  <text x="80" y="62" text-anchor="middle" class="mono" fill="#1e40af" font-weight="bold">Profile</text>
  <!-- Trunk -->
  <line x1="40" y1="72" x2="40" y2="350" stroke="#64748b" stroke-width="1.5"/>
  <!-- Phase 0: Pre-infusion -->
  <circle cx="40" cy="100" r="3" fill="#64748b"/>
  <line x1="40" y1="100" x2="70" y2="100" stroke="#64748b" stroke-width="1.5"/>
  <rect x="70" y="85" width="290" height="30" rx="5" fill="white" stroke="#334155" stroke-width="1.5"/>
  <text x="215" y="105" text-anchor="middle" class="mono" fill="#0f172a">Phase 0: Pre-infusion (pressure or flow)</text>
  <line x1="360" y1="100" x2="380" y2="100" stroke="#64748b" stroke-width="1"/>
  <line x1="380" y1="85" x2="380" y2="140" stroke="#64748b" stroke-width="1"/>
  <line x1="380" y1="85" x2="400" y2="85" stroke="#64748b" stroke-width="1"/>
  <text x="410" y="89" fill="#64748b" font-size="10">Transition: instant, linear, ease-in/out</text>
  <line x1="380" y1="105" x2="400" y2="105" stroke="#64748b" stroke-width="1"/>
  <text x="410" y="109" fill="#64748b" font-size="10">Stop: time, pressure, flow, weight</text>
  <line x1="380" y1="125" x2="400" y2="125" stroke="#64748b" stroke-width="1"/>
  <text x="410" y="129" fill="#64748b" font-size="10">Restriction: max flow or max pressure</text>
  <!-- Phase 1: Soak -->
  <circle cx="40" cy="170" r="3" fill="#64748b"/>
  <line x1="40" y1="170" x2="70" y2="170" stroke="#64748b" stroke-width="1.5"/>
  <rect x="70" y="155" width="290" height="30" rx="5" fill="white" stroke="#334155" stroke-width="1.5"/>
  <text x="215" y="175" text-anchor="middle" class="mono" fill="#0f172a">Phase 1: Soak (optional hold/dwell)</text>
  <text x="380" y="175" fill="#64748b" font-size="10">Same structure as above</text>
  <!-- Phase 2: Ramp -->
  <circle cx="40" cy="215" r="3" fill="#64748b"/>
  <line x1="40" y1="215" x2="70" y2="215" stroke="#64748b" stroke-width="1.5"/>
  <rect x="70" y="200" width="290" height="30" rx="5" fill="white" stroke="#334155" stroke-width="1.5"/>
  <text x="215" y="220" text-anchor="middle" class="mono" fill="#0f172a">Phase 2: Ramp to extraction pressure</text>
  <text x="380" y="220" fill="#64748b" font-size="10">Soak â†’ brew pressure transition</text>
  <!-- Phase N -->
  <circle cx="40" cy="260" r="3" fill="#64748b"/>
  <line x1="40" y1="260" x2="70" y2="260" stroke="#64748b" stroke-width="1.5"/>
  <rect x="70" y="245" width="290" height="30" rx="5" fill="white" stroke="#334155" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="215" y="265" text-anchor="middle" class="mono" fill="#94a3b8">Phase N: ... (variable number)</text>
  <!-- Global Stop Conditions -->
  <circle cx="40" cy="310" r="3" fill="#64748b"/>
  <line x1="40" y1="310" x2="70" y2="310" stroke="#64748b" stroke-width="1.5"/>
  <rect x="70" y="295" width="220" height="30" rx="5" fill="#fee2e2" stroke="#dc2626" stroke-width="1.5"/>
  <text x="180" y="315" text-anchor="middle" class="mono" fill="#991b1b">Global Stop Conditions</text>
  <line x1="290" y1="310" x2="310" y2="310" stroke="#64748b" stroke-width="1"/>
  <line x1="310" y1="298" x2="310" y2="348" stroke="#64748b" stroke-width="1"/>
  <line x1="310" y1="298" x2="330" y2="298" stroke="#64748b" stroke-width="1"/>
  <text x="340" y="302" fill="#991b1b" font-size="11">Total time limit</text>
  <line x1="310" y1="318" x2="330" y2="318" stroke="#64748b" stroke-width="1"/>
  <text x="340" y="322" fill="#991b1b" font-size="11">Total weight limit</text>
  <line x1="310" y1="338" x2="330" y2="338" stroke="#64748b" stroke-width="1"/>
  <text x="340" y="342" fill="#991b1b" font-size="11">Total water pumped limit</text>
</svg>
