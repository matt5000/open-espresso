<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500" width="800" height="500">
  <style>
    text { font-family: 'Source Sans 3', sans-serif; }
    .mono { font-family: 'Source Code Pro', monospace; }
  </style>

  <defs>
    <marker id="arrow-data" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#3b82f6" stroke-width="1.5"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="500" fill="#f8fafc" rx="4"/>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" fill="#0f172a" font-size="16" font-weight="bold">Inter-Task Queue Architecture</text>

  <!-- ======= Row 1: SensorReading ======= -->
  <!-- Producer: ControlTask -->
  <rect x="30" y="55" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="105" y="80" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">ControlTask</text>

  <!-- Arrow: producer → queue -->
  <line x1="180" y1="75" x2="270" y2="75" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="225" y="67" text-anchor="middle" fill="#64748b" font-size="11">produces</text>

  <!-- Queue box -->
  <rect x="280" y="55" width="260" height="40" rx="12" fill="#dbeafe" stroke="#1e40af" stroke-width="2"/>
  <text x="410" y="72" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold" class="mono">SensorReading</text>
  <text x="410" y="86" text-anchor="middle" fill="#1e40af" font-size="10" class="mono">{temp, pressure, flow, weight}</text>

  <!-- Arrow: queue → consumer -->
  <line x1="540" y1="75" x2="610" y2="75" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="575" y="67" text-anchor="middle" fill="#64748b" font-size="11">consumes</text>

  <!-- Consumer: UITask -->
  <rect x="620" y="55" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="695" y="76" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">UITask</text>
  <text x="695" y="89" text-anchor="middle" fill="#64748b" font-size="10">display / WS</text>

  <!-- ======= Row 2: ShotDataPoint ======= -->
  <!-- Producer: ControlTask -->
  <rect x="30" y="165" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="105" y="190" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">ControlTask</text>

  <!-- Arrow: producer → queue -->
  <line x1="180" y1="185" x2="270" y2="185" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="225" y="177" text-anchor="middle" fill="#64748b" font-size="11">produces</text>

  <!-- Queue box -->
  <rect x="280" y="160" width="260" height="48" rx="12" fill="#dbeafe" stroke="#1e40af" stroke-width="2"/>
  <text x="410" y="178" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold" class="mono">ShotDataPoint</text>
  <text x="410" y="198" text-anchor="middle" fill="#1e40af" font-size="10" class="mono">{time, pressure, flow, weight, target_p}</text>

  <!-- Arrow: queue → consumer -->
  <line x1="540" y1="185" x2="610" y2="185" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="575" y="177" text-anchor="middle" fill="#64748b" font-size="11">consumes</text>

  <!-- Consumer: UITask -->
  <rect x="620" y="165" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="695" y="186" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">UITask</text>
  <text x="695" y="199" text-anchor="middle" fill="#64748b" font-size="10">shot graph</text>

  <!-- ======= Row 3: ConfigUpdate ======= -->
  <!-- Producer: UITask -->
  <rect x="30" y="275" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="105" y="300" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">UITask</text>

  <!-- Arrow: producer → queue -->
  <line x1="180" y1="295" x2="270" y2="295" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="225" y="287" text-anchor="middle" fill="#64748b" font-size="11">produces</text>

  <!-- Queue box -->
  <rect x="280" y="275" width="260" height="40" rx="12" fill="#dbeafe" stroke="#1e40af" stroke-width="2"/>
  <text x="410" y="292" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold" class="mono">ConfigUpdate</text>
  <text x="410" y="306" text-anchor="middle" fill="#1e40af" font-size="10" class="mono">{new profile, new settings}</text>

  <!-- Arrow: queue → consumer -->
  <line x1="540" y1="295" x2="610" y2="295" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="575" y="287" text-anchor="middle" fill="#64748b" font-size="11">consumes</text>

  <!-- Consumer: ControlTask -->
  <rect x="620" y="275" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="695" y="296" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">ControlTask</text>
  <text x="695" y="309" text-anchor="middle" fill="#64748b" font-size="10">applies changes</text>

  <!-- ======= Row 4: ScaleReading ======= -->
  <!-- Producer: BLETask -->
  <rect x="30" y="385" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="105" y="410" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">BLETask</text>

  <!-- Arrow: producer → queue -->
  <line x1="180" y1="405" x2="270" y2="405" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="225" y="397" text-anchor="middle" fill="#64748b" font-size="11">produces</text>

  <!-- Queue box -->
  <rect x="280" y="385" width="260" height="40" rx="12" fill="#dbeafe" stroke="#1e40af" stroke-width="2"/>
  <text x="410" y="402" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold" class="mono">ScaleReading</text>
  <text x="410" y="416" text-anchor="middle" fill="#1e40af" font-size="10" class="mono">{weight, stable}</text>

  <!-- Arrow: queue → consumer -->
  <line x1="540" y1="405" x2="610" y2="405" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-data)"/>
  <text x="575" y="397" text-anchor="middle" fill="#64748b" font-size="11">consumes</text>

  <!-- Consumer: ControlTask -->
  <rect x="620" y="385" width="150" height="40" rx="6" fill="white" stroke="#334155" stroke-width="2"/>
  <text x="695" y="410" text-anchor="middle" fill="#0f172a" font-size="13" font-weight="bold">ControlTask</text>

  <!-- Separator lines -->
  <line x1="30" y1="130" x2="770" y2="130" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="30" y1="240" x2="770" y2="240" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="30" y1="350" x2="770" y2="350" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4,4"/>

  <!-- Row labels -->
  <text x="400" y="148" text-anchor="middle" fill="#94a3b8" font-size="10">Sensor data for UI display and WebSocket broadcast</text>
  <text x="400" y="258" text-anchor="middle" fill="#94a3b8" font-size="10">Real-time shot graphing data points</text>
  <text x="400" y="368" text-anchor="middle" fill="#94a3b8" font-size="10">User-initiated configuration changes from web/display UI</text>
  <text x="400" y="460" text-anchor="middle" fill="#94a3b8" font-size="10">BLE scale weight data for gravimetric shot control</text>

  <!-- Legend -->
  <rect x="30" y="470" width="14" height="3" fill="#3b82f6" rx="1"/>
  <text x="50" y="475" fill="#64748b" font-size="10">Data flow (FreeRTOS xQueue)</text>
  <rect x="180" y="466" width="30" height="14" rx="6" fill="#dbeafe" stroke="#1e40af" stroke-width="1"/>
  <text x="216" y="475" fill="#64748b" font-size="10">Queue (struct type)</text>
  <rect x="340" y="466" width="30" height="14" rx="4" fill="white" stroke="#334155" stroke-width="1.5"/>
  <text x="376" y="475" fill="#64748b" font-size="10">FreeRTOS Task</text>
</svg>